sudo: required
dist: trusty

language: go
go:
- '1.13'

services:
- docker

cache:
  directories:
  - "$HOME/.cache/go-build"

env:
  global:
    GIT_TAG=$(git describe --tags)

before_install:
- openssl aes-256-cbc -K $encrypted_a30037d67e8c_key -iv $encrypted_a30037d67e8c_iv -in travis_deploy_key.enc -out ./travis_deploy_key -d

script: go test -v -race ./...

before_deploy:
- go run ./scripts/deploy/build_binaries.go

deploy:
- provider: releases
  api_key:
    secure: Pl8+IkwU+/F0b9htgPfROP+lqlPjAhZ//6W94FpYX9W9tDXpYh5J+2YUqcxbHkjaB/qE62ndkTG9uyFcgQ3L8hzXpjTiF5dLHuter5HqmPz8afvePjvsI9xoY8vQSt5+XDKYzS/NA5pXpdJSzjpMb8ThF5kb7MAlgk3zoRcCsVrrrP/Dh8LLLXpg+rQDAj0BTX/PXdWVoWnF50kTcP1iWCsafaw9c8GfKnJUrsiSjGOlUU+/S/dntHbgbLVaI8Jm51VLEmZyiyaKtY6mO5NyrwzHflJ5iaYBnC01lA+WpKJQprDbz2hP73+E7IcFvmj3GsekWym3tf3B6V10MMqnF32AqivpJUy8YKglEs77s9ZhGJ/OTZ7lzN0NBkzR4cfouPXg/NDueaDOEGLanDhPVkXFeSpJBh3LP/DA/78Np18lD9rk2JegMRPmv8GkCDiiVLFQ3TaysXIhvWJAf8JkwTlirBOeBXRZ1vfuZiOjwcarmNEy75S4s91Q0teu+W4RCLthgKoE/27hyVRvVSvnZIu7utMnfRDXfwlsvGZJmWxKxP1l7w/mZr3xoWIerFHb79QpgR6n9zZ+5+HcQkxqii22g7ikjHGbRmX8Yq06EPlDLUFFFs+xyFG413Q9zetea4X2Jsuz0alufGQkL/SEep2Rq/WVOqmndoriSQZPHak=
  file_glob: true
  file: "./build/*"
  skip_cleanup: true
  on:
    tags: true
- provider: script
  script: "bash ./scripts/deploy/deploy.sh"
  skip_cleanup: true
  on:
    tags: true

notifications:
  slack:
    secure: pbJLqnA2ilvWp9REuHrWqf/Pl/hSGkENBvjBPQyW6TvJytUHiObwP/aCQxyL31i8ZzItc1r+9db1tk12BFE5eObxyb4DHmHbaQ1/pwA7Bzf2SsM5J68Pyr9w/kXk44PUqfifeBLH/xhjCNtm+f8ZIkJiKfOZxgn9ddYt/vG4Nt8w6s43ZODDO+Caql1AH1iZ4xsJ6X/VPyvWfh9FaZpYnDQBI10fcsg4kGMZ6+p4pZ2wvRyo8LQJoIUcDGXATr7+kr3wB04r3BRAACydg0bDWPpuRBn6svIar6J12lHR05n0K+rtl+VYLLGJZuNPn3Tqh7tdt0ifrPTE0W1fM24mlOikLlYWhZ5Olf23DVxbxqeegu/x4E4ctT9ua/0UbBfZHVlb9pzFf+OoSYwX/N7dE9Dt7zuoeMebL3ECYXxyEvP1qHLNvxmeVydFFHKy2pu1pSQP/paz+1ShqgjbMOHFrz52HVvy/7b1qCMKDFnpYp6lc9adPgWJpsxGAY2dMw83iBJno+A9LF3LJzhv2TdRC+w1fQTUBdzW/wUkDLa9diHNdolN/2gFsAK8iJtLc2cz6hAh/2U4mRdrBjCULqZcGwBRS5jPA79zDZpMwhbET2j3vrqUx6iicAI8MI6Nptkt3g193trwS7oljXOkpdqBkXdh/ZpRYoiK/3nOc/LKfnI=
